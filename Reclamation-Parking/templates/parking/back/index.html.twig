{% extends 'base.html.twig' %}



{% block changeMe %}
    <div class="container-fluid pt-4 px-4">
        <div class="bg-secondary rounded-top p-4">
            <div class="row">
                {% block search %}
                    <form>
                        <div class="input-group input-group-dynamic mb-8">
                            <input class="form-control" id="search" placeholder="Search" type="text" >
                        </div>
                    </form>
                {% endblock %}

            </div>
            {% if parkings %}
            <div class="col-12">
                <div class="bg-secondary rounded h-100 p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h6 class="mb-4">Liste des Parkings</h6>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="t">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Capacite</th>
                                <th>Taken Places</th>
                                <th>Prix/h</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody id="all">
                            {% for parking in parkings %}
                                <tr>
                                    <td><img src="{{ vich_uploader_asset(parking, 'imageFile') }}" alt="parking-img" style="width: 40px; height: 40px; border-radius: 50%"></td>
                                    <td>{{ parking.nomParking }}</td>
                                    <td>{{ parking.capaciteParking }}</td>
                                    <td>{{ parking.takenpParking }}</td>
                                    <td>{{ parking.prixParking }}</td>
                                    <td>
                                        <a href="{{ path('modifier-parking',{'id':parking.IdParking}) }}" class="btn btn-dark">Modifier</a>
                                        <a href="{{ path('delete-parking',{'id':parking.IdParking}) }}" class="btn btn-danger" onclick="return confirm('Etes-vous sÃ»r de supprimer ce Produit?');">Supprimer</a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                            <tbody id="search"></tbody>
                        </table>
                    </div>
                    {% else %}
                        <p>Aucun produit</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $( document ).ready(function() {
            $("#search").keyup(function(e){
                var value = $(this).val();
                console.log(value)
                $.ajax({
                    url : "{{ path('searchParking') }}",
                    type : 'GET',
                    data: {
                        'searchValue' : value
                    },
                    success : function(retour){
                        if(retour){
                            console.log("retour", retour)
                            $('#t tbody#search').empty();
                            $.each(JSON.parse(retour), function(o, obj) {
                                $('#t tbody#all').hide();
                                $('#t tbody#search').append("<tr>");
                                let normalizedPath = ""+obj.logoParking;
                                var p= "http://localhost:8000/images/parkings/" + normalizedPath;
                                var img = "<img src="+p+" width='100' height='100'/>";
                                $('#t tbody#search').append(" <td>"+img+"</td>");
                                //$('#t tbody#search').append(" <a href='obj.localisation'>"+'GO'+"</a>");
                                $('#t tbody#search').append("</tr>");
                                $('#t tbody#search').append(" <td>"+obj.nomParking+"</td>");
                                $('#t tbody#search').append(" <td>"+obj.capaciteParking+"</td>");
                                $('#t tbody#search').append(" <td>"+obj.takenpParking+"</td>");
                                //  $('#t tbody#search').append(" <td>"+obj.logo+"</td>");
                                $('#t tbody#search').append(" <td>"+obj.prixParking+"</td>");
                                var link = $("<a>")
                                    .attr("href", "{{ path('modifier-parking',{'id': 'parkingId'}) }}".replace("parkingId", obj.IdParking))
                                    .addClass("btn btn-dark")
                                    .text("Modifier");
                                var td = $("<td>").append(link);
                                $('#t tbody#search').append(td);
                                $('#t tbody#search').append("</tr>");
                                var link = $("<a>")
                                    .attr("href", "{{ path('delete-parking',{'id': 'parkingId'}) }}".replace("parkingId", obj.IdParking))
                                    .addClass("btn btn-dark")
                                    .text("Delete");
                                var td = $("<td>").append(link);
                                $('#t tbody#search').append(td);
                                $('#t tbody#search').append("</tr>");
                            });
                        }
                        // $('#t tbody#search').append('<tr><td> '+obj.lieu+'  </td><td>    '+obj.nbPlace+'  </td><td>'+obj.descriptions+' </td><td>'+obj.dateEvent+' </td><td>'+obj.getcategory+' </td><td>'+obj.Description+'</td><td><td><a href="event/'+obj.idEvent+'/edit">Modifier</a></td></tr>');
                        else{
                            $('#t tbody#all').show();
                            $('#t tbody#search').empty();
                            $('#t tbody#search').fadeIn('fast');
                        }
                    },
                });
                return false;
            });
        });
    </script>

{% endblock %}
